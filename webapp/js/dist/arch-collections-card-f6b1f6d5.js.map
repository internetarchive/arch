{"version":3,"file":"arch-collections-card-f6b1f6d5.js","sources":["../../../src/src/archCollectionsCard/src/styles.ts","../../../src/src/archCollectionsCard/src/arch-collections-card.ts"],"sourcesContent":["import { css } from \"lit\";\n\nimport { global, cardTable } from \"../../lib/styles\";\n\nexport default [\n  global,\n  cardTable,\n  css`\n    thead > tr.hidden-header {\n      color: transparent;\n    }\n\n    th.size,\n    th.num-datasets {\n      text-align: right;\n    }\n\n    th.size {\n      width: 7rem;\n    }\n\n    th.num-datasets {\n      width: 10rem;\n    }\n\n    td.name {\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      overflow-x: hidden;\n    }\n\n    td.size,\n    td.num-datasets {\n      text-align: right;\n    }\n  `,\n];\n","import { LitElement, html } from \"lit\";\nimport { customElement, state } from \"lit/decorators.js\";\n\nimport { Collection, Dataset } from \"../../lib/types\";\nimport { Paths, humanBytes } from \"../../lib/helpers\";\n\nimport \"../../archCard/index\";\nimport \"../../archLoadingIndicator/index\";\n\nimport styles from \"./styles\";\n\n@customElement(\"arch-collections-card\")\nexport class ArchCollectionsCard extends LitElement {\n  @state() collections: undefined | Array<Collection> = undefined;\n  @state() collectionDatasetCounts:\n    | undefined\n    | Record<Collection[\"id\"], number> = undefined;\n\n  static numDisplayedCollections = 10;\n  static styles = styles;\n\n  constructor() {\n    super();\n    void this.initCollections();\n    void this.initCollectionDatasetCounts();\n  }\n\n  render() {\n    const { numDisplayedCollections } = ArchCollectionsCard;\n    const isLoading = this.collections === undefined;\n    // Note that the value of hasCollection is only valid when isLoading=false;\n    const hasCollections = (this.collections ?? []).length > 0;\n    const getRows = () =>\n      isLoading\n        ? [\n            html`\n              <tr>\n                <td colspan=\"3\">\n                  <arch-loading-indicator></arch-loading-indicator>\n                </td>\n              </tr>\n            `,\n          ]\n        : !hasCollections\n        ? [\n            html`\n              <tr>\n                <td colspan=\"3\">\n                  <i\n                    >No collections found.\n                    <a\n                      href=\"https://arch-webservices.zendesk.com/hc/en-us/articles/14795196010772\"\n                      >Contact us</a\n                    >\n                    to access collections or report an error.</i\n                  >\n                </td>\n              </tr>\n            `,\n          ]\n        : (this.collections ?? []).slice(0, numDisplayedCollections).map(\n            (collection) => html`\n              <tr>\n                <td class=\"name\">\n                  <a\n                    href=\"/collections/${collection.id}\"\n                    title=\"${collection.name}\"\n                  >\n                    ${collection.name}\n                  </a>\n                </td>\n                <td class=\"size\">\n                  ${humanBytes(\n                    collection.sortSize === -1 ? 0 : collection.sortSize,\n                    1\n                  )}\n                </td>\n                <td class=\"num-datasets\">\n                  ${this.collectionDatasetCounts === undefined\n                    ? html`<arch-loading-indicator></arch-loading-indicator>`\n                    : `${\n                        this.collectionDatasetCounts[collection.id] ?? 0\n                      } Datasets`}\n                </td>\n              </tr>\n            `\n          );\n    return html`\n      <arch-card\n        title=\"Collections\"\n        ctatext=${!isLoading && hasCollections\n          ? \"Create Custom Collection\"\n          : \"\"}\n        ctahref=\"${Paths.buildSubCollection()}\"\n      >\n        <div slot=\"content\">\n          <table>\n            <thead>\n              <tr\n                class=\"${isLoading || !hasCollections ? \"hidden-header\" : \"\"}\"\n              >\n                <th class=\"name\">Collection Name</th>\n                <th class=\"size\">Collection Size</th>\n                <th class=\"num-datasets\">Generated Datasets</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${getRows()}\n            </tbody>\n          </table>\n        </div>\n        <div slot=\"footer\">\n          ${isLoading || !hasCollections\n            ? html``\n            : html`\n                <a href=\"/collections\" class=\"view-all\">\n                  View\n                  ${(this.collections ?? []).length > numDisplayedCollections\n                    ? html`All ${(this.collections ?? []).length}`\n                    : html``}\n                  Collections\n                </a>\n              `}\n        </div>\n      </arch-card>\n    `;\n  }\n\n  private async initCollections() {\n    this.collections = (await (\n      await fetch(\"/api/collections\")\n    ).json()) as Array<Collection>;\n  }\n\n  private async initCollectionDatasetCounts() {\n    const datasets = (await (\n      await fetch(\"/api/datasets?state=Finished\")\n    ).json()) as Array<Dataset>;\n    const counts: typeof this.collectionDatasetCounts = {};\n    for (const dataset of datasets) {\n      const { collectionId } = dataset;\n      counts[collectionId] = (counts[collectionId] ?? 0) + 1;\n    }\n    // Overwrite the state variable to trigger a component update.\n    this.collectionDatasetCounts = counts;\n  }\n}\n\n// Injects the tag into the global name space\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"arch-collections-card\": ArchCollectionsCard;\n  }\n}\n"],"names":["styles","global","cardTable","css","ArchCollectionsCard","ArchCollectionsCard_1","LitElement","constructor","super","this","collections","undefined","collectionDatasetCounts","initCollections","initCollectionDatasetCounts","render","numDisplayedCollections","isLoading","hasCollections","_a","length","html","Paths","buildSubCollection","slice","map","collection","id","name","humanBytes","sortSize","getRows","_b","_c","async","fetch","json","datasets","counts","dataset","collectionId","__decorate","state","prototype","customElement"],"mappings":"odAIA,MAAeA,EAAA,CACbC,EACAC,EACAC,CAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;KCKE,IAAMC,EAAmBC,EAAzB,cAAkCC,EASvCC,cACEC,QATOC,KAAWC,iBAAkCC,EAC7CF,KAAuBG,6BAEOD,EAOhCF,KAAKI,kBACLJ,KAAKK,6BACX,CAEDC,mBACE,MAAMC,wBAAEA,GAA4BX,EAC9BY,OAAiCN,IAArBF,KAAKC,YAEjBQ,GAAsC,QAApBC,EAAAV,KAAKC,mBAAe,IAAAS,EAAAA,EAAA,IAAIC,OAAS,EAwDzD,OAAOC,CAAI;;;mBAGIJ,GAAaC,EACpB,2BACA;mBACOI,EAAMC;;;;;;yBAMAN,IAAcC,EAAiB,gBAAkB;;;;;;;;gBAnEtD,YACd,OAAAD,EACI,CACEI,CAAI;;;;;;eAQLH,GAiBgB,QAAhBC,EAAAV,KAAKC,mBAAW,IAAAS,EAAAA,EAAI,IAAIK,MAAM,EAAGR,GAAyBS,KACxDC,UAAe,OAAAL,CAAI;;;;yCAISK,EAAWC;6BACvBD,EAAWE;;sBAElBF,EAAWE;;;;oBAIbC,GACyB,IAAzBH,EAAWI,SAAkB,EAAIJ,EAAWI,SAC5C;;;yBAIiCnB,IAAjCF,KAAKG,wBACHS,CAAI,oDACJ,GAC6C,QAA3CF,EAAAV,KAAKG,wBAAwBc,EAAWC,WAAG,IAAAR,EAAAA,EAAI;;;aAI1D,IAzCH,CACEE,CAAI;;;;;;;;;;;;;cAyCL,EAqBKU;;;;;YAKJd,IAAcC,EACZG,CAAI,GACJA,CAAI;;;qBAGmB,QAAhBW,EAAAvB,KAAKC,mBAAW,IAAAsB,EAAAA,EAAI,IAAIZ,OAASJ,EAChCK,CAAI,QAA4B,QAApBY,EAAAxB,KAAKC,mBAAe,IAAAuB,EAAAA,EAAA,IAAIb,SACpCC,CAAI;;;;;;KAOvB,CAEOa,wBACNzB,KAAKC,wBACGyB,MAAM,qBACZC,MACH,CAEOF,0CACN,MAAMG,cACEF,MAAM,iCACZC,OACIE,EAA8C,CAAA,EACpD,IAAK,MAAMC,KAAWF,EAAU,CAC9B,MAAMG,aAAEA,GAAiBD,EACzBD,EAAOE,IAAyC,QAAxBrB,EAAAmB,EAAOE,UAAiB,IAAArB,EAAAA,EAAA,GAAK,CACtD,CAEDV,KAAKG,wBAA0B0B,CAChC,GA/HMlC,EAAuBY,wBAAG,GAC1BZ,EAAMJ,OAAGA,EANPyC,EAAA,CAARC,KAA+DtC,EAAAuC,UAAA,mBAAA,GACvDF,EAAA,CAARC,KAEgDtC,EAAAuC,UAAA,+BAAA,GAJtCvC,EAAmBC,EAAAoC,EAAA,CAD/BG,EAAc,0BACFxC"}