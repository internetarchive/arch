{"version":3,"file":"arch-collections-card-90b322bf.js","sources":["../../../src/src/archCollectionsCard/src/styles.ts","../../../src/src/archCollectionsCard/src/arch-collections-card.ts"],"sourcesContent":["import { css } from \"lit\";\n\nimport { global, cardTable } from \"../../lib/styles\";\n\nexport default [\n  global,\n  cardTable,\n  css`\n    thead > tr.hidden-header {\n      color: transparent;\n    }\n\n    th.size,\n    th.num-datasets {\n      text-align: right;\n    }\n\n    th.size {\n      width: 7rem;\n    }\n\n    th.num-datasets {\n      width: 10rem;\n    }\n\n    td.name {\n      text-overflow: ellipsis;\n      white-space: nowrap;\n      overflow-x: hidden;\n    }\n\n    td.size,\n    td.num-datasets {\n      text-align: right;\n    }\n  `,\n];\n","import { LitElement, html } from \"lit\";\nimport { customElement, state } from \"lit/decorators.js\";\n\nimport ArchAPI from \"../../lib/ArchAPI\";\nimport { FilteredApiResponse, Collection, Dataset } from \"../../lib/types\";\nimport { Paths, humanBytes } from \"../../lib/helpers\";\n\nimport \"../../archCard/index\";\nimport \"../../archLoadingIndicator/index\";\n\nimport styles from \"./styles\";\n\n@customElement(\"arch-collections-card\")\nexport class ArchCollectionsCard extends LitElement {\n  @state() numTotalCollections = 0;\n  @state() collections: undefined | Array<Collection> = undefined;\n  @state() collectionDatasetCounts:\n    | undefined\n    | Record<Collection[\"id\"], number> = undefined;\n\n  static maxDisplayedCollections = 10;\n  static styles = styles;\n\n  constructor() {\n    super();\n    void this.initCollections();\n    void this.initCollectionDatasetCounts();\n  }\n\n  render() {\n    const { maxDisplayedCollections } = ArchCollectionsCard;\n    const isLoading = this.collections === undefined;\n    // Note that the value of hasCollection is only valid when isLoading=false;\n    const hasCollections = this.numTotalCollections > 0;\n    const getRows = () =>\n      isLoading\n        ? [\n            html`\n              <tr>\n                <td colspan=\"3\">\n                  <arch-loading-indicator></arch-loading-indicator>\n                </td>\n              </tr>\n            `,\n          ]\n        : !hasCollections\n        ? [\n            html`\n              <tr>\n                <td colspan=\"3\">\n                  <i\n                    >No collections found.\n                    <a\n                      href=\"https://arch-webservices.zendesk.com/hc/en-us/articles/14795196010772\"\n                      >Contact us</a\n                    >\n                    to access collections or report an error.</i\n                  >\n                </td>\n              </tr>\n            `,\n          ]\n        : (this.collections ?? []).slice(0, maxDisplayedCollections).map(\n            (collection) => html`\n              <tr>\n                <td class=\"name\">\n                  <a\n                    href=\"/collections/${collection.id}\"\n                    title=\"${collection.name}\"\n                  >\n                    ${collection.name}\n                  </a>\n                </td>\n                <td class=\"size\">\n                  ${humanBytes(\n                    collection.sortSize === -1 ? 0 : collection.sortSize,\n                    1\n                  )}\n                </td>\n                <td class=\"num-datasets\">\n                  ${this.collectionDatasetCounts === undefined\n                    ? html`<arch-loading-indicator></arch-loading-indicator>`\n                    : `${\n                        this.collectionDatasetCounts[collection.id] ?? 0\n                      } Datasets`}\n                </td>\n              </tr>\n            `\n          );\n    return html`\n      <arch-card\n        title=\"Collections\"\n        ctatext=${!isLoading && hasCollections\n          ? \"Create Custom Collection\"\n          : \"\"}\n        ctahref=\"${Paths.buildSubCollection()}\"\n        ctaTooltipHeader=\"Custom Collection\"\n        ctaTooltipText=\"Combine and filter your collections into a Custom Collection of only the data you need.\"\n        ctaTooltipLearnMoreUrl=\"https://arch-webservices.zendesk.com/hc/en-us/articles/16107865758228-How-to-create-a-custom-ARCH-collection\"\n      >\n        <div slot=\"content\">\n          <table>\n            <thead>\n              <tr\n                class=\"${isLoading || !hasCollections ? \"hidden-header\" : \"\"}\"\n              >\n                <th class=\"name\">Collection Name</th>\n                <th class=\"size\">Collection Size</th>\n                <th class=\"num-datasets\">Generated Datasets</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${getRows()}\n            </tbody>\n          </table>\n        </div>\n        <div slot=\"footer\">\n          ${isLoading || !hasCollections\n            ? html``\n            : html`\n                <a href=\"/collections\" class=\"view-all\">\n                  View\n                  ${this.numTotalCollections > maxDisplayedCollections\n                    ? html`All ${this.numTotalCollections}`\n                    : html``}\n                  Collections\n                </a>\n              `}\n        </div>\n      </arch-card>\n    `;\n  }\n\n  private async initCollections() {\n    const response = (await ArchAPI.collections.get([\n      [\"sort\", \"=\", \"-lastJobTime\"],\n      [\"limit\", \"=\", ArchCollectionsCard.maxDisplayedCollections],\n    ])) as FilteredApiResponse<Collection>;\n    this.numTotalCollections = response.count;\n    this.collections = response.results;\n  }\n\n  private async initCollectionDatasetCounts() {\n    const response = (await ArchAPI.datasets.get([\n      [\"state\", \"=\", \"Finished\"],\n    ])) as FilteredApiResponse<Dataset>;\n    const { results: datasets } = response;\n    const counts: typeof this.collectionDatasetCounts = {};\n    for (const dataset of datasets) {\n      const { collectionId } = dataset;\n      counts[collectionId] = (counts[collectionId] ?? 0) + 1;\n    }\n    // Overwrite the state variable to trigger a component update.\n    this.collectionDatasetCounts = counts;\n  }\n}\n\n// Injects the tag into the global name space\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"arch-collections-card\": ArchCollectionsCard;\n  }\n}\n"],"names":["styles","global","cardTable","css","ArchCollectionsCard","ArchCollectionsCard_1","LitElement","constructor","super","this","numTotalCollections","collections","undefined","collectionDatasetCounts","initCollections","initCollectionDatasetCounts","render","maxDisplayedCollections","isLoading","hasCollections","html","Paths","buildSubCollection","_a","slice","map","collection","id","name","humanBytes","sortSize","getRows","async","response","ArchAPI","get","count","results","datasets","counts","dataset","collectionId","__decorate","state","prototype","customElement"],"mappings":"sgBAIA,MAAeA,EAAA,CACbC,EACAC,EACAC,CAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;KCME,IAAMC,EAAmBC,EAAzB,cAAkCC,EAUvCC,cACEC,QAVOC,KAAmBC,oBAAG,EACtBD,KAAWE,iBAAkCC,EAC7CH,KAAuBI,6BAEOD,EAOhCH,KAAKK,kBACLL,KAAKM,6BACX,CAEDC,SACE,MAAMC,wBAAEA,GAA4BZ,EAC9Ba,OAAiCN,IAArBH,KAAKE,YAEjBQ,EAAiBV,KAAKC,oBAAsB,EAwDlD,OAAOU,CAAI;;;mBAGIF,GAAaC,EACpB,2BACA;mBACOE,EAAMC;;;;;;;;;yBASAJ,IAAcC,EAAiB,gBAAkB;;;;;;;;gBAtEtD,YACd,OAAAD,EACI,CACEE,CAAI;;;;;;eAQLD,GAiBgB,QAAhBI,EAAAd,KAAKE,mBAAW,IAAAY,EAAAA,EAAI,IAAIC,MAAM,EAAGP,GAAyBQ,KACxDC,UAAe,OAAAN,CAAI;;;;yCAISM,EAAWC;6BACvBD,EAAWE;;sBAElBF,EAAWE;;;;oBAIbC,GACyB,IAAzBH,EAAWI,SAAkB,EAAIJ,EAAWI,SAC5C;;;yBAIiClB,IAAjCH,KAAKI,wBACHO,CAAI,oDACJ,GAC6C,QAA3CG,EAAAd,KAAKI,wBAAwBa,EAAWC,WAAG,IAAAJ,EAAAA,EAAI;;;aAI1D,IAzCH,CACEH,CAAI;;;;;;;;;;;;;cAyCL,EAwBKW;;;;;YAKJb,IAAcC,EACZC,CAAI,GACJA,CAAI;;;oBAGEX,KAAKC,oBAAsBO,EACzBG,CAAI,OAAOX,KAAKC,sBAChBU,CAAI;;;;;;KAOvB,CAEOY,wBACN,MAAMC,QAAkBC,EAAQvB,YAAYwB,IAAI,CAC9C,CAAC,OAAQ,IAAK,gBACd,CAAC,QAAS,IAAK9B,EAAoBY,2BAErCR,KAAKC,oBAAsBuB,EAASG,MACpC3B,KAAKE,YAAcsB,EAASI,OAC7B,CAEOL,0CACN,MAAMC,QAAkBC,EAAQI,SAASH,IAAI,CAC3C,CAAC,QAAS,IAAK,eAETE,QAASC,GAAaL,EACxBM,EAA8C,CAAA,EACpD,IAAK,MAAMC,KAAWF,EAAU,CAC9B,MAAMG,aAAEA,GAAiBD,EACzBD,EAAOE,IAAyC,QAAxBlB,EAAAgB,EAAOE,UAAiB,IAAAlB,EAAAA,EAAA,GAAK,CACtD,CAEDd,KAAKI,wBAA0B0B,CAChC,GAtIMnC,EAAuBa,wBAAG,GAC1Bb,EAAMJ,OAAGA,EAPP0C,EAAA,CAARC,KAAgCvC,EAAAwC,UAAA,2BAAA,GACxBF,EAAA,CAARC,KAA+DvC,EAAAwC,UAAA,mBAAA,GACvDF,EAAA,CAARC,KAEgDvC,EAAAwC,UAAA,+BAAA,GALtCxC,EAAmBC,EAAAqC,EAAA,CAD/BG,EAAc,0BACFzC"}