{"version":3,"file":"arch-collections-table-b565b17a.js","sources":["../../../src/src/archCollectionsTable/src/styles.ts","../../../src/src/archCollectionsTable/src/arch-collections-table.ts"],"sourcesContent":["import { css } from \"lit\";\n\nexport default [\n  css`\n    data-table > table {\n      table-layout: fixed;\n    }\n\n    data-table > table > thead > tr > th.public {\n      width: 5em;\n    }\n\n    data-table > table > thead > tr > th.dataset-date {\n      width: 7em;\n    }\n\n    data-table > table > thead > tr > th.size {\n      width: 7em;\n    }\n\n    data-table > table > thead > tr > th {\n      max-width: none;\n    }\n  `,\n];\n","import { PropertyValues } from \"lit\";\nimport { customElement } from \"lit/decorators.js\";\n\nimport { ArchDataTable } from \"../../archDataTable/index\";\nimport { Collection } from \"../../lib/types\";\nimport { Topics } from \"../../lib/pubsub\";\nimport {\n  Paths,\n  humanBytes,\n  htmlAttrEscape as _,\n  isoStringToDateString,\n} from \"../../lib/helpers\";\nimport Styles from \"./styles\";\n\n@customElement(\"arch-collections-table\")\nexport class ArchCollectionsTable extends ArchDataTable<Collection> {\n  static styles = [...ArchDataTable.styles, ...Styles];\n\n  willUpdate(_changedProperties: PropertyValues) {\n    super.willUpdate(_changedProperties);\n\n    this.actionButtonLabels = [\"Generate Dataset\", \"Create Custom Collection\"];\n    this.actionButtonSignals = [\n      Topics.GENERATE_DATASET,\n      Topics.CREATE_SUB_COLLECTION,\n    ];\n    this.apiCollectionEndpoint = \"/collections\";\n\n    /* eslint-disable @typescript-eslint/restrict-template-expressions */\n    this.cellRenderers = [\n      (name, collection: Collection) => `\n        <a href=\"/collections/${_(collection.id)}\" title=\"${_(name as string)}\">\n          <span class=\"highlightable\">${name}</span>\n        </a>\n      `,\n      { true: \"Yes\", false: \"No\" },\n      (lastJobName, collection: Collection) => {\n        if (lastJobName === null) {\n          return \"\";\n        }\n        lastJobName = lastJobName as string;\n        const lastJobId = collection.lastJobId as string;\n        const lastJobSample = collection.lastJobSample as boolean;\n        // Convert the lastJobSample boolean to a Dataset.sample integer.\n        const datasetSample = lastJobSample ? 1 : -1;\n        // NOTE - this manual Dataset ID string composition is brittle\n        return `\n          <a href=\"${Paths.dataset(\n            `${collection.id}:${lastJobId}`,\n            datasetSample\n          )}\" title=\"${_(lastJobName)}\">\n            <span class=\"highlightable\">${lastJobName}</span>\n          </a>\n        `;\n      },\n      (lastJobTime) =>\n        !lastJobTime ? \"\" : isoStringToDateString(lastJobTime as string),\n      (_, collection: Collection) => {\n        return humanBytes(\n          collection.sortSize === -1 ? 0 : collection.sortSize,\n          1\n        );\n      },\n    ];\n    /* eslint-enable @typescript-eslint/restrict-template-expressions */\n\n    this.columnFilterDisplayMaps = [undefined, { true: \"Yes\", false: \"No\" }];\n    this.columns = [\"name\", \"public\", \"lastJobName\", \"lastJobTime\", \"sortSize\"];\n    this.columnHeaders = [\n      \"Name\",\n      \"Public\",\n      \"Latest Dataset\",\n      \"Dataset Date\",\n      \"Size\",\n    ];\n    this.selectable = true;\n    this.sort = \"name\";\n    this.sortableColumns = [true, false, true, true, true];\n    this.filterableColumns = [false, true];\n    this.searchColumns = [\"name\"];\n    this.searchColumnLabels = [\"Name\"];\n    this.singleName = \"Collection\";\n    this.persistSearchStateInUrl = true;\n    this.pluralName = \"Collections\";\n  }\n\n  postSelectionChangeHandler(selectedRows: Array<Collection>) {\n    /* Update DataTable.actionButtonDisabled based on the number\n       of selected rows.\n    */\n    const { dataTable } = this;\n    const { props } = dataTable;\n    const numSelected = selectedRows.length;\n    const generateDatasetEnabled = numSelected === 1;\n    const createSubCollectionEnabled = true;\n    props.actionButtonDisabled = [\n      !generateDatasetEnabled,\n      !createSubCollectionEnabled,\n    ];\n    dataTable.setSelectionActionButtonDisabledState(numSelected === 0);\n  }\n\n  selectionActionHandler(action: string, selectedRows: Array<Collection>) {\n    switch (action) {\n      case Topics.GENERATE_DATASET:\n        window.location.href = Paths.generateCollectionDataset(\n          selectedRows[0].id\n        );\n        break;\n      case Topics.CREATE_SUB_COLLECTION:\n        window.location.href = Paths.buildSubCollection(\n          selectedRows.map((x) => x.id)\n        );\n    }\n  }\n}\n\n// Injects the tag into the global name space\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"arch-collections-table\": ArchCollectionsTable;\n  }\n}\n"],"names":["Styles","css","ArchCollectionsTable","ArchDataTable","willUpdate","_changedProperties","super","this","actionButtonLabels","actionButtonSignals","Topics","GENERATE_DATASET","CREATE_SUB_COLLECTION","apiCollectionEndpoint","cellRenderers","name","collection","_","id","true","false","lastJobName","lastJobId","datasetSample","lastJobSample","Paths","dataset","lastJobTime","isoStringToDateString","humanBytes","sortSize","columnFilterDisplayMaps","undefined","columns","columnHeaders","selectable","sort","sortableColumns","filterableColumns","searchColumns","searchColumnLabels","singleName","persistSearchStateInUrl","pluralName","postSelectionChangeHandler","selectedRows","dataTable","props","numSelected","length","generateDatasetEnabled","actionButtonDisabled","setSelectionActionButtonDisabledState","selectionActionHandler","action","window","location","href","generateCollectionDataset","buildSubCollection","map","x","styles","__decorate","customElement"],"mappings":"qkBAEA,IAAeA,EAAA,CACbC,CAAG;;;;;;;;;;;;;;;;;;;;KCYE,IAAMC,EAAN,cAAmCC,EAGxCC,WAAWC,GACTC,MAAMF,WAAWC,GAEjBE,KAAKC,mBAAqB,CAAC,mBAAoB,4BAC/CD,KAAKE,oBAAsB,CACzBC,EAAOC,iBACPD,EAAOE,uBAETL,KAAKM,sBAAwB,eAG7BN,KAAKO,cAAgB,CACnB,CAACC,EAAMC,IAA2B,mCACRC,EAAED,EAAWE,eAAeD,EAAEF,+CACtBA,iCAGlC,CAAEI,KAAM,MAAOC,MAAO,MACtB,CAACC,EAAaL,KACZ,GAAoB,OAAhBK,EACF,MAAO,GAGT,MAAMC,EAAYN,EAAWM,UAGvBC,EAFgBP,EAAWQ,cAEK,GAAK,EAE3C,MAAO,wBACMC,EAAMC,QACf,GAAGV,EAAWE,MAAMI,IACpBC,cACWN,EAAEI,iDACiBA,oCAEjC,EAEFM,GACEA,EAAmBC,EAAsBD,GAA3B,GACjB,CAACV,EAAGD,IACKa,GACoB,IAAzBb,EAAWc,SAAkB,EAAId,EAAWc,SAC5C,IAMNvB,KAAKwB,wBAA0B,MAACC,EAAW,CAAEb,KAAM,MAAOC,MAAO,OACjEb,KAAK0B,QAAU,CAAC,OAAQ,SAAU,cAAe,cAAe,YAChE1B,KAAK2B,cAAgB,CACnB,OACA,SACA,iBACA,eACA,QAEF3B,KAAK4B,YAAa,EAClB5B,KAAK6B,KAAO,OACZ7B,KAAK8B,gBAAkB,EAAC,GAAM,GAAO,GAAM,GAAM,GACjD9B,KAAK+B,kBAAoB,EAAC,GAAO,GACjC/B,KAAKgC,cAAgB,CAAC,QACtBhC,KAAKiC,mBAAqB,CAAC,QAC3BjC,KAAKkC,WAAa,aAClBlC,KAAKmC,yBAA0B,EAC/BnC,KAAKoC,WAAa,aACnB,CAEDC,2BAA2BC,GAIzB,MAAMC,UAAEA,GAAcvC,MAChBwC,MAAEA,GAAUD,EACZE,EAAcH,EAAaI,OAC3BC,EAAyC,IAAhBF,EAE/BD,EAAMI,qBAAuB,EAC1BD,GACD,GAEFJ,EAAUM,sCAAsD,IAAhBJ,EACjD,CAEDK,uBAAuBC,EAAgBT,GACrC,OAAQS,GACN,KAAK5C,EAAOC,iBACV4C,OAAOC,SAASC,KAAOhC,EAAMiC,0BAC3Bb,EAAa,GAAG3B,IAElB,MACF,KAAKR,EAAOE,sBACV2C,OAAOC,SAASC,KAAOhC,EAAMkC,mBAC3Bd,EAAae,KAAKC,GAAMA,EAAE3C,MAGjC,GAlGMhB,EAAM4D,OAAG,IAAI3D,EAAc2D,UAAW9D,GADlCE,EAAoB6D,EAAA,CADhCC,EAAc,2BACF9D"}